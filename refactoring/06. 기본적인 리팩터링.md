# 06. 기본적인 리팩터링

## 6.1 함수 추출하기

- 코드를 '의도'의 단위로 작게 나누고 각각 함수로 옮겨 추출한다.
  * 새로 만들어진 함수에서 원래 함수에 있던 변수가 없지만 필요하다면, 매개변수 통해 해당 값을 전달받기
  * 추출 대상 코드 조각에서 본래 함수의 어떤 변수의 값을 바꾼다면, 추출된 함수에서 값을 반환하고, 그 값을 본래 함수에서 받아서 지역 변수에 할당하는 식으로 변경
  * 추출 대상 코드 조각에서 하나의 변수가 아닌 여러 개 변수를 수정한다면 가장 좋은 방법은 변수마다 새로운 함수를 만드는 것.

## 6.2 함수 인라인하기

- 함수의 본문이 함수 이름만큼이나 그 자체로 명확한 경우에는 굳이 따로 함수가 필요 없으니 본문을 호출자 본문에 인라인한다.
- 한 줄씩 인라인화 작업을 진행해야 실수를 피할 수 있다.

## 6.3 변수 추출하기

- 표현식에서 복잡한 부분들은 별도의 변수로 빼내어 주면 각각의 구성 요소를 이해하기가 쉬워짐.
- 절차: 추출 대상 표현식 부분을 별도 변수로 복사 -> 테스트 -> 원래 표현식에서 추출된 부분을 새로운 변수로 치환 -> 테스트 -> 다른 곳에서도 동일하게 적용 -> 테스트

## 6.4 변수 인라인하기

- 변수 표현식만으로도 값의 의미를 파악하기 쉬운 경우에는 별도 변수로 사용하지 않고 인라인화함.

## 6.5 함수 선언 바꾸기

- 함수명 바꾸기와 함수 매개변수 바꾸기 모두 포함
- 함수 선언부 중 매개변수를 잘 수정하면 해당 함수와 다른 모듈 간의 결합도를 낮출 수 있음.
- 간단한 선언부 변경은 IDE 등 이용해서 간단하게 수행할 수 있지만 복잡한 변경 또는 함수를 사용하는 곳이 많은 경우 등에는 점진적으로 마이그레이션 절차 통해 리팩터링 수행.
- 간단한 절차: 선언부 수정 후, 해당 함수를 사용하는 호출문을 모두 변경.
- 마이그레이션 절차: 새로운 임시 함수를 만들고, 임시 함수로 본래 함수 본문을 옮겨 넣고, 본래 함수 인라인화하고(호출문이 임시 함수를 호출하게끔 변경), 본래 함수 삭제, 임시 함수의 함수명을 본래 함수의 함수명으로 변경

## 6.6 변수 캡슐화하기

- 최대한 변수의 유효범위를 작게 해서 변수에 가해지는 변경을 쉽게 파악, 관리할 수 있게 하는 것이 바람직
- 객체의 경우 객체를 생성한 곳에서 멀리 떨어진 곳에서 객체의 프로퍼티를 수정하면 예상치 못한 파급 효과가 있을 수 있어, 최대한 불변성을 흉내 내는 것이 중요(ex. dayjs)
- 클래스의 필드는 public 말고 private 등으로 설정해서 외부 접근 차단

## 6.7 변수 이름 바꾸기

- 코드의 가독성을 높이기 위해 변수 이름을 바꾸고, 변수 캡슐화가 안 되어 있는 경우 캡슐화도 적용

## 6.8 매개변수 객체 만들기

- 매개변수 목록 중에 항상 함께 사용되는 경향이 있는 몇 개의 매개변수가 있다면, 그 매개변수들을 가지고 새로운 클래스를 만들기
- 예: 범위(최솟값/최댓값 등 값의 범위, 날짜 범위 등), 좌표(x, y 좌표), 주소, 전화번호(국가코드와 전화번호 묶음)
- 매개변수 객체는 불변성 있게 해 주는 것이 좋음
- 나중에 코드 짜다 보면 더 많은 연산을 매개변수 클래스 안에 넣어 줄 수 있음. 이렇게 하게 되면서 데이터와 연산이 더 모이게 됨

## 6.9 여러 함수를 클래스로 묶기

- 같은 데이터를 가지고 작업을 하는 연산들은 한 클래스로 모으는 것이 좋음.
- 연산들이 클래스에 모이면 각 연산의 매개변수 수를 줄일 수 있고, 함수를 이해하는 데 문맥을 제공하고, 클래스로부터 만들어진 객체는 코드의 다른 부분에서 값처럼 사용될 수 있음.

## 6.10 여러 함수를 변환 함수로 묶기

- 6.9 여러 함수를 클래스로 묶기와 비슷한 최종 효과가 있음.(서로 연관 있는 연산들을 한곳에 모으기)
- 여러 개의 함수가 매개변수로 어떤 데이터를 받아서 어떤 결과를 계산하고 반환하는 것이 연산이 흩어져 있는 모습이라면, 변환 함수는 하나의 함수 안에서 매개변수로 받은 값을 가지고 여러 가지 연산을 하고, 최종 결과 객체에 프로퍼티로 계산 값을 담는 방법임.
- enrich: 매개변수로 받은 객체에 계산된 값을 프로퍼티로 추가하고, 객체를 반환함.
- transform: 매개변수로 받은 객체와 계산 값을 가지고 새로운 모양의 객체를 만들고 반환.
- 원본 데이터와 계산된 값이 한 객체에 같이 담기는 방식에서는 객체를 받고 난 뒤에 원본 데이터 바꿀 시에 계산된 값이 따라서 갱신되지 않고 일관성이 깨진다는 문제가 있어서, 객체의 값을 함부로 변경하면 안 됨.

## 6.11 단계 쪼개기

- 컴파일러 등 복잡한 프로그램에서는 최종 목적(컴파일러의 경우 소스코드를 실행 가능한 기계어로 변환하기) 달성을 위해 작업 과정을 더 작은 작업의 연결로 이해하고 구현함.
- 꼭 컴파일러처럼 복잡한 로직이 아니라도 단계 쪼개기를 통해 로직을 더 이해하기 쉽게 만들 수 있음.
- 파이프 필터 패턴과 비슷
- 각 과정의 경계점에서 이전 완료된 함수에서 처리 결과를 객체를 통해 다음 함수로 전달함으로써 처리 과정을 연결시킴.
- 절차: (2개의 단계로 쪼갤 수 있는 경우) 두 번째 단계를 별도의 함수로 추출 -> 중간 결과 전달을 위한 클래스 생성 및 추출된 함수의 매개변수 목록에 추가 -> 추출된 함수의 매개변수 목록에서 중간 결과 클래스로 옮길 수 있는 변수들은 옮기고, 더 이상 필요 없는 변수들은 목록에서 삭제 -> 첫 번째 단계를 별도의 함수로 추출하고, 계산 결과를 중간 결과 클래스에 담아서 반환.
